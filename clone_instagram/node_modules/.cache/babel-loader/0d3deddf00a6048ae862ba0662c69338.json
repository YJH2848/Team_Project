{"ast":null,"code":"import _regeneratorRuntime from\"C:/\\uBC30\\uD3EC/Team_Project/clone_instagram/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/\\uBC30\\uD3EC/Team_Project/clone_instagram/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/\\uBC30\\uD3EC/Team_Project/clone_instagram/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Link}from'react-router-dom';import{useRef,useState,useEffect,useContext}from'react';import AuthContext from\"../context/AuthProvider\";import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LOGIN_URL='http://127.0.0.1:8000/user/signin/';var Login=function Login(){var _useContext=useContext(AuthContext),setAuth=_useContext.setAuth;var userRef=useRef();var errRef=useRef();//이메일 이름 비밀번호\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),nickname=_useState4[0],setName=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),password=_useState6[0],setPwd=_useState6[1];//성공실패 여부\nvar _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),errMsg=_useState8[0],setErrMsg=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),success=_useState10[0],setSuccess=_useState10[1];useEffect(function(){userRef.current.focus();},[]);useEffect(function(){setErrMsg('');},[email,nickname,password]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _response$data,_response$data2,response,token,roles,_err$response,_err$response2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return axios.post(LOGIN_URL,JSON.stringify({email:email,nickname:nickname,password:password}),{headers:{\"Content-Type\":'application/json'}});case 4:response=_context.sent;console.log(JSON.stringify(response===null||response===void 0?void 0:response.data));//console.log(JSON.stringify(response));\ntoken=response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.token;roles=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.roles;setAuth({email:email,nickname:nickname,password:password,roles:roles,token:token});setEmail('');setPwd('');setSuccess(true);_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](1);if(!(_context.t0!==null&&_context.t0!==void 0&&_context.t0.response)){setErrMsg('No Server Response');}else if(((_err$response=_context.t0.response)===null||_err$response===void 0?void 0:_err$response.status)===400){setErrMsg('Missing Username or Password');}else if(((_err$response2=_context.t0.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setErrMsg('Unauthorized');}else{setErrMsg('Login Failed');}errRef.current.focus();case 18:case\"end\":return _context.stop();}}},_callee,null,[[1,14]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Link,{to:\"/sign\",children:success?/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"You are logged in!\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"#\",children:\"Go to Home\"})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"sign_container\",children:/*#__PURE__*/_jsxs(\"section\",{className:\"login_section\",children:[/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errMsg?\"errmsg\":\"offscreen\",\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsxs(\"div\",{className:\"sign_border\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"sign_img\",width:\"185\",height:\"70\",src:\"./image/pngegg.png\"}),/*#__PURE__*/_jsx(\"div\",{className:\"sign\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[\" \",/*#__PURE__*/_jsxs(\"div\",{className:\"email\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"useremail\"}),/*#__PURE__*/_jsx(\"input\",{className:\"sign_input\",type:\"text\",id:\"useremail\",ref:userRef,autoComplete:\"off\",onChange:function onChange(e){return setEmail(e.target.value);},value:email,required:true,placeholder:\"\\uD734\\uB300\\uD3F0 \\uBC88\\uD638 \\uB610\\uB294 \\uC774\\uBA54\\uC77C \\uC8FC\\uC18C\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"nickname\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"nickname\"}),/*#__PURE__*/_jsx(\"input\",{className:\"sign_input\",type:\"nickname\",id:\"nickname\",ref:userRef,autoComplete:\"off\",onChange:function onChange(e){return setName(e.target.value);},value:nickname,required:true,placeholder:\"\\uC131\\uBA85\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pwd\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\"}),/*#__PURE__*/_jsx(\"input\",{className:\"login_input\",type:\"password\",id:\"password\",ref:userRef,autoComplete:\"off\",onChange:function onChange(e){return setPwd(e.target.value);},value:password,required:true,placeholder:\"\\uBE44\\uBC00\\uBC88\\uD638\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"sign_button\",children:\"Sign In\"})]})})]})]})})});};export default Login;","map":{"version":3,"names":["Link","useRef","useState","useEffect","useContext","AuthContext","axios","LOGIN_URL","Login","setAuth","userRef","errRef","email","setEmail","nickname","setName","password","setPwd","errMsg","setErrMsg","success","setSuccess","current","focus","handleSubmit","e","preventDefault","post","JSON","stringify","headers","response","console","log","data","token","roles","status","target","value"],"sources":["C:/배포/Team_Project/clone_instagram/src/Sign_components/Sign.js"],"sourcesContent":["import { Link } from 'react-router-dom';\r\nimport { useRef, useState, useEffect, useContext } from 'react';\r\nimport AuthContext from \"../context/AuthProvider\";\r\nimport axios from 'axios';\r\n\r\nconst LOGIN_URL = 'http://127.0.0.1:8000/user/signin/';\r\n\r\nconst Login = () => {\r\n    const { setAuth } = useContext(AuthContext);\r\n    const userRef = useRef();\r\n    const errRef = useRef();\r\n\r\n\r\n    //이메일 이름 비밀번호\r\n    const [email, setEmail] = useState('');\r\n    const [nickname, setName] = useState('');\r\n    const [password, setPwd] = useState('');\r\n\r\n    //성공실패 여부\r\n    const [errMsg, setErrMsg] = useState('');\r\n    const [success, setSuccess] = useState(false);\r\n\r\n    useEffect(() => {\r\n        userRef.current.focus();\r\n\r\n    }, [])\r\n    useEffect(() => {\r\n        setErrMsg('');\r\n    }, [email, nickname, password])\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault(); {/*(e)코드를 작동하지 못하게 하는 메서드*/ }\r\n\r\n        try {\r\n            const response = await axios.post(LOGIN_URL,\r\n                JSON.stringify({ email, nickname, password }), {\r\n                headers: {\r\n                    \"Content-Type\": 'application/json',\r\n                },\r\n            });\r\n            console.log(JSON.stringify(response?.data));\r\n            //console.log(JSON.stringify(response));\r\n            const token = response?.data?.token;\r\n            const roles = response?.data?.roles;\r\n            setAuth({ email, nickname, password, roles, token });\r\n            setEmail('');\r\n            setPwd('');\r\n            setSuccess(true);\r\n        } catch (err) {\r\n            if (!err?.response) {\r\n                setErrMsg('No Server Response');\r\n            }\r\n            else if (err.response?.status === 400) {\r\n                setErrMsg('Missing Username or Password');\r\n            }\r\n            else if (err.response?.status === 401) {\r\n                setErrMsg('Unauthorized');\r\n            }\r\n            else {\r\n                setErrMsg('Login Failed');\r\n            }\r\n            errRef.current.focus();\r\n        }\r\n    }\r\n    return (\r\n        <Link to=\"/sign\">\r\n            {success ? (\r\n                <section>\r\n                    <h1>You are logged in!</h1>\r\n                    <br />\r\n                    <p>\r\n                        <a href=\"#\">Go to Home</a>\r\n                    </p>\r\n                </section>\r\n            ) : (\r\n                <div className=\"sign_container\">\r\n                    <section className='login_section'>\r\n                        <p ref={errRef} className={errMsg ? \"errmsg\" :\r\n                            \"offscreen\"} aria-live=\"assertive\">{errMsg}</p>\r\n                        <div className='sign_border'>\r\n                            <img className='sign_img' width=\"185\" height=\"70\" src=\"./image/pngegg.png\"></img>\r\n                            <div className=\"sign\">\r\n                                <form onSubmit={handleSubmit}> {/*form전송을 하기 전 입력된 데이터의 유효성 체크하는 것*/}\r\n                                    <div className=\"email\">\r\n                                        <label htmlFor=\"useremail\"></label>\r\n                                        <input\r\n                                            className='sign_input'\r\n                                            type=\"text\"\r\n                                            id=\"useremail\"\r\n                                            ref={userRef}\r\n                                            autoComplete=\"off\"\r\n                                            onChange={(e) => setEmail(e.target.value)}\r\n                                            value={email}\r\n                                            required\r\n                                            placeholder=\"휴대폰 번호 또는 이메일 주소\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"nickname\">\r\n                                        <label htmlFor=\"nickname\"></label>\r\n                                        <input\r\n                                            className='sign_input'\r\n                                            type=\"nickname\"\r\n                                            id=\"nickname\"\r\n                                            ref={userRef}\r\n                                            autoComplete=\"off\"\r\n                                            onChange={(e) => setName(e.target.value)}\r\n                                            value={nickname}\r\n                                            required\r\n                                            placeholder=\"성명\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"pwd\">\r\n                                        <label htmlFor=\"password\"></label>\r\n                                        <input\r\n                                            className='login_input'\r\n                                            type=\"password\"\r\n                                            id=\"password\"\r\n                                            ref={userRef}\r\n                                            autoComplete=\"off\"\r\n                                            onChange={(e) => setPwd(e.target.value)}\r\n                                            value={password}\r\n                                            required\r\n                                            placeholder=\"비밀번호\"\r\n                                        />\r\n                                    </div>\r\n                                    <button className='sign_button'>Sign In</button>\r\n                                </form>\r\n                            </div>\r\n                        </div>\r\n                    </section>\r\n                </div>\r\n            )}\r\n        </Link>\r\n    )\r\n}\r\n\r\nexport default Login\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}